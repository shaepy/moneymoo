<%- include('../partials/_header') %>
    <title>Portfolio</title>
</head>
<body>
    <a href="/">Home</a>
    <h1>My Portfolio</h1>
    <% if (!activePortfolio) { %>
    <a href="/portfolio/new">+ Create portfolio</a>
    <% } %>

    <% if (portfolios) { %>
    <h2>overview</h2>
        <h2>$<%= portfolioTotalValue.toFixed(2) %></h2>
        <% portfolios.forEach(p => { %>
          <p><a href="/portfolio?id=<%= p._id %>"><%= p.name %></a> - $<%= (p.totalValue).toFixed(2) %></p>
        <% }); %>
    <% } %>

    <% if (activePortfolio) { %>
        <p><a href="/portfolio">Back</a></p>
        <h2><%= activePortfolio.name %></h2>
        <div>
            <a href="/portfolio/<%= activePortfolio._id %>/edit">EDIT</a>
            <a href="/portfolio/<%= activePortfolio._id %>/remove">REMOVE</a>
        </div>
        <h2>total: $<%= (activePortfolio.totalValue).toFixed(2) %></h2>
        <h3>holdings</h3>
        <p><a href="/portfolio/<%= activePortfolio._id %>/trades">View Trades</a></p>

        <% activePortfolio.userStocks.forEach((userStock) => { %>
            <div class="user-stocks-div">
                <h4><%= userStock.stock.symbol %> (<%= userStock.stock.companyName %>)</h4>
                <p>shares: <%= userStock.quantity %></p>
                <p>cost basis per share: $<%= (userStock.costBasis).toFixed(2) %></p>
                <p>total cost: $<%= (userStock.totalCost).toFixed(2) %></p>
                <p>current price per share: $<%= userStock.stock.price %></p>
                <p>current value: $<%= (userStock.stock.price * userStock.quantity).toFixed(2) %></p>
                <p>unrealized P/L: $<%= ((userStock.stock.price * userStock.quantity) - userStock.totalCost).toFixed(2) %> </p>
                <p>unrealized P/L %: <%= ((((userStock.stock.price * userStock.quantity) - userStock.totalCost) / userStock.totalCost)*100).toFixed(2) %></p>
            </div>
        <% }) %>

        <p><a href="/portfolio/<%= activePortfolio._id %>/trades/new">+ Add Trade</a></p>
    <% } %>
</body>
</html>