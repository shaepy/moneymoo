<%- include('../partials/_header') %>
    <title>Watchlist</title>
</head>
<body>
    <%- include('../partials/_navbar') %>
    <% if (!activeWatchlist) { %>
    <h1 class="is-size-3 ml-5 mr-5 mt-2 mb-2">Watchlists</h1>
    <a href="/watchlist/new" class="button is-link ml-5 mr-5 mt-1 mb-1">+ Create watchlist</a>
    <% } %>

    <% if (watchlists) { %>
    <div class="ml-5 mr-5 mt-3 mb-4">
        <h2 class="is-size-4 mb-2">Overview</h2>
        <% watchlists.forEach(list => { %>
            <p class="button is-link is-outlined is-small"><a href="/watchlist?id=<%= list._id %>"><%= list.name %></a></p>
        <% }); %>
    </div>
    <% } %>

    <% if (activeWatchlist) { %>
    <p class="ml-5 mr-5 mt-3 mb-3"><a href="/watchlist">Back to Watchlists</a></p>
    <% if (activeWatchlist.edit) { %>
        <form action="/watchlist/<%= activeWatchlist._id %>?_method=PUT" method="POST" class="ml-5 mr-5 mt-2 mb-2">
            <input type="text" name="name" value="<%= activeWatchlist.name %>" class="input is-normal" />
            <button type="submit" class="button is-link mt-3">update</button>
        </form>
    <% } else { %>
        <h1 class="is-size-3 mt-2 mb-1 ml-5 mr-4"><%= activeWatchlist.name %></h1>
    <% } %>
    <div class="mb-2 ml-5 mr-4">
        <a href="/watchlist?id=<%= activeWatchlist._id %>&edit=true">edit</a> |
        <a href="/watchlist/<%= activeWatchlist._id %>/remove">remove</a>
    </div>
    <section class="m-5">
        <table class="table is-hoverable is-fullwidth">
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Price</th>
                    <th>Day Change</th>
                    <th>Day Change %</th>
                </tr>
            </thead>
            <tbody>
            <% activeWatchlist.stocks.forEach((stock) => { %>
                <tr>
                    <td>
                        <div class="symbol-and-image">
                            <img src="<%= stock.image %>" alt="logo for <%= stock.companyName %>" class="image is-16x16"/>
                            <a href="/stock/<%= stock.symbol %>"><%= stock.symbol %></a>
                        </div>
                    </td>
                    <td><%= stock.price %></td>
                    <td><%= (stock.change).toFixed(2) %></td>
                    <td><%= (stock.changePercentage).toFixed(2) %></td>
                    <% if (activeWatchlist.edit) {%>
                        <td>
                        <form action="/watchlist/<%= activeWatchlist._id %>/remove?id=<%= stock._id %>&_method=PUT" method="POST">
                            <button class="delete" type="submit"></button>
                        </form>
                        </td>
                    <% } %>
                </tr>
            <% }) %>
            </tbody>
        </table>
    </section>
    <% } %>

    <% if (stocks) { %>
    <section class="m-5">
        <table class="table is-hoverable is-fullwidth">
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Price</th>
                    <th>Day Change</th>
                    <th>Day Change %</th>
                </tr>
            </thead>
            <tbody>
            <% stocks.forEach((stock) => { %>
                <tr>
                    <td>
                        <div class="symbol-and-image">
                            <img src="<%= stock.image %>" alt="logo for <%= stock.companyName %>" class="image is-16x16"/>
                            <a href="/stock/<%= stock.symbol %>"><%= stock.symbol %></a>
                        </div>
                    </td>
                    <td><%= (stock.price).toFixed(2) %></td>
                    <td><%= (stock.change).toFixed(2) %></td>
                    <td><%= (stock.changePercentage).toFixed(2) %></td>
                </tr>
            <% }) %>
            </tbody>
        </table>
    </section>
    <% } %>

    <% if (!stocks && !activeWatchlist) { %>
    <p class="ml-5 mr-5 mt-4"><a href="/search">Search</a> for stocks and add to your watchlist(s).</p>
    <% } %>
</body>
</html>